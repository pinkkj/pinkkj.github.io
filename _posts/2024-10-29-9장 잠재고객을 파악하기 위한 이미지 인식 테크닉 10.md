---
# Header
title: "9.ì ì¬ê³ ê°ì„ íŒŒì•…í•˜ê¸° ìœ„í•œ ì´ë¯¸ì§€ ì¸ì‹ í…Œí¬ë‹‰ 10"
excerpt: "ì ì¬ê³ ê°ì„ íŒŒì•…í•˜ê¸° ìœ„í•œ ì´ë¯¸ì§€ ì¸ì‹ í…Œí¬ë‹‰ 10"
name: J
writer: J
categories: [ë°ë¹„&ì¶”ì²œì‹œìŠ¤í…œ, íŒŒì´ì¬ ë°ì´í„°ë¶„ì„ ì‹¤ë¬´ í…Œí¬ë‹‰ 100] # [ë©”ì¸ ì¹´í…Œê³ ë¦¬, ì„œë¸Œ ì¹´í…Œê³ ë¦¬]
tags:
  - [Khuda, ML, data]

toc: true
toc_sticky: true

date: 2024-10-29
last_modified_at: 2024-10-29

# --- ì•„ë˜ ë¶€í„° content
---
â­OpenCV ì´ìš©

ğŸ”–ì „ì œì¡°ê±´
- ëŒ€ë¦¬ì  ì• ë„ë¡œì˜ ë™ì˜ìƒ/ì´ë¯¸ì§€ë¥¼ ë‹¤ë£¸.
    - mov í´ë”: ë™ì˜ìƒ
    - img í´ë”: ì´ë¯¸ì§€
    - snapshot í´ë”(ë¹ˆ í´ë”): ë™ì˜ìƒì„ ì´ë¯¸ì§€í™”í•œ ê²ƒ(ìŠ¤ëƒ…ìˆ)

![alt text](/assets/img_20241102/image-26.png)

# 081.ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì

```py
from google.colab.patches import cv2_imshow
!curl -o logo.png https://colab.research.google.com/img/colab_favicon_256px.png
import cv2
# íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆëŸ¬ì˜´
img = cv2.imread("/content/drive/MyDrive/á„á…®á„ƒá…¡/á„á…®á„ƒá…¡ 6á„€á…µ/9á„Œá…¡á†¼/img/img01.jpg", cv2.IMREAD_UNCHANGED)
height, width = img.shape[:2]
# 3ì°¨ì› (a,b,c) -> aì™€ bë§Œ ì¶”ì¶œ
print("ì´ë¯¸ì§€ ê°€ë¡œ: " + str(width))
print("ì´ë¯¸ì§€ ì„¸ë¡œ: " + str(height))
# ì´ë¯¸ì§€ ê°€ë¡œ: 1920
# ì´ë¯¸ì§€ ì„¸ë¡œ: 1440
cv2_imshow(img)
# ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸°
cv2.waitKey(0)
# ëª‡ ì´ˆ ë™ì•ˆ ì´ë¯¸ì§€ë¥¼ í‘œì‹œí• ì§€ë¥¼ ë°€ë¦¬ì´ˆ ë‹¨ìœ„ë¡œ ì§€ì •(ìœˆë„ìš°ë¥¼ ë‹«ì„ë•Œê¹Œì§€ ê³„ì†í•´ì„œ ë³´ì—¬ì¤„ ê²½ìš°ì—ëŠ” 0ìœ¼ë¡œ ì§€ì •)
cv2.destroyAllWindows()
```
![alt text](/assets/img_20241102/image-25.png)

# 082. ë™ì˜ìƒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì
```py
import cv2

# ì •ë³´ ì·¨ë“ #
cap = cv2.VideoCapture("/content/drive/MyDrive/á„á…®á„ƒá…¡/á„á…®á„ƒá…¡ 6á„€á…µ/9á„Œá…¡á†¼/mov/mov01.avi")
width = cap.get(cv2.CAP_PROP_FRAME_WIDTH)
height = cap.get(cv2.CAP_PROP_FRAME_HEIGHT)
count = cap.get(cv2.CAP_PROP_FRAME_COUNT)
fps = cap.get(cv2.CAP_PROP_FPS)
print("ê°€ë¡œ: " + str(width))
print("ì„¸ë¡œ: " + str(height))
print("ì´ í”„ë ˆì„ìˆ˜: " + str(count))
print("FPS: " + str(fps))
#ê°€ë¡œ: 1920.0
#ì„¸ë¡œ: 1440.0
#ì´ í”„ë ˆì„ìˆ˜: 401.0
#FPS: 30.0 -> ë¹„ë””ì˜¤ì˜ ì´ˆë‹¹ í”„ë ˆì„ ìˆ˜

# ì¶œë ¥ #
while(cap.isOpened()):  # ë¹„ë””ì˜¤ íŒŒì¼ì´ ì—´ë ¤ ìˆëŠ” ë™ì•ˆ ë°˜ë³µ
    ret, frame = cap.read()  
    # í˜„ì¬ í”„ë ˆì„ì„ ì½ê¸°. ì„±ê³µí•˜ë©´ ret=Trueì™€ í•´ë‹¹ í”„ë ˆì„ì„ ë°˜í™˜
    if ret:  # í”„ë ˆì„ì„ ì„±ê³µì ìœ¼ë¡œ ì½ì€ ê²½ìš°
        cv2_imshow(frame)  # Google Colabì—ì„œ í”„ë ˆì„ì„ í™”ë©´ì— í‘œì‹œ
    if cv2.waitKey(1) & 0xFF == ord("q"):  # ì‚¬ìš©ìê°€ 'q' í‚¤ë¥¼ ëˆ„ë¥´ë©´ ë°˜ë³µ ì¢…ë£Œ
        break
cap.release()  # ë¹„ë””ì˜¤ ìº¡ì²˜ ìì› í•´ì œ
cv2.destroyAllWindows()  # ëª¨ë“  ì°½ ë‹«ê¸°
```

# 083.ë™ì˜ìƒì„ ì´ë¯¸ì§€ë¡œ ë‚˜ëˆ„ê³  ì €ì¥í•˜ì

```py
import cv2
cap = cv2.VideoCapture("/content/drive/MyDrive/á„á…®á„ƒá…¡/á„á…®á„ƒá…¡ 6á„€á…µ/9á„Œá…¡á†¼/mov/mov01.avi")
num = 0
while(cap.isOpened()):
    ret, frame = cap.read()
    # cap.read()ë¡œ ë¹„ë””ì˜¤ì˜ ë‹¤ìŒ í”„ë ˆì„ì„ ì½ì–´ì˜µë‹ˆë‹¤
    if ret:
        cv2_imshow(frame)
        filepath = "snapshot/snapshot_" + str(num) + ".jpg"
        cv2.imwrite(filepath,frame)
        # cv2.imwrite(filepath, frame)ëŠ” í˜„ì¬ í”„ë ˆì„ì„ filepath ìœ„ì¹˜ì— ì´ë¯¸ì§€ íŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤
        if cv2.waitKey(1) & 0xFF == ord('q'):
            break
    num = num + 1
cap.release()
# cap.release()ëŠ” ë¹„ë””ì˜¤ ìº¡ì²˜ ê°ì²´ë¥¼ í•´ì œí•˜ì—¬ ë¹„ë””ì˜¤ íŒŒì¼ì„ ë‹«ìŠµë‹ˆë‹¤.
cv2.destroyAllWindows()
```
![alt text](/assets/img_20241102/image-27.png)

# 084.ì´ë¯¸ì§€ ì†ì— ì‚¬ëŒì´ ì–´ë””ì— ìˆëŠ”ì§€ ê²€ì¶œí•´ ë³´ì

ì‚¬ëŒì„ ì¸ì‹í•˜ê¸° ìœ„í•´ì„œëŠ” 'HOG íŠ¹ì§•ëŸ‰'

- Hog?: íœ˜ë„(ë¹›ì˜ ë‹¨ìœ„ ì¤‘ í•˜ë‚˜)ì˜ ê¸°ìš¸ê¸°(ì‚¬ëŒ ì‹¤ë£¨ì—£ í˜•íƒœì˜ íŠ¹ì§•ì„ ìœ„ì¹˜ë‚˜ ê°ë„ë¡œ í‘œí˜„í•œ ê²ƒ)

![alt text](/assets/img_20241102/image-28.png)

```py
import cv2

# ì¤€ë¹„ #
hog = cv2.HOGDescriptor()
#  HOG ê°ì²´ë¥¼ ì´ˆê¸°í™”
hog.setSVMDetector(cv2.HOGDescriptor_getDefaultPeopleDetector())
# SVM ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ HOG ê¸°ë°˜ì˜ ì‚¬ëŒ ê²€ì¶œê¸°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì´ëŠ” OpenCVì— ë‚´ì¥ëœ ê¸°ë³¸ ì‚¬ëŒ ê²€ì¶œê¸°ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹
hogParams = {'winStride': (8, 8), 'padding': (32, 32), 'scale': 1.05, 'hitThreshold':0, 'finalThreshold':5}
# hogParams ë³€ìˆ˜ëŠ” ê²€ì¶œê¸°ì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ì„¤ì •

# ê²€ì¶œ #
img = cv2.imread("/content/drive/MyDrive/á„á…®á„ƒá…¡/á„á…®á„ƒá…¡ 6á„€á…µ/9á„Œá…¡á†¼/img/img01.jpg")
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
# ì´ë¯¸ì§€ë¥¼ ê·¸ë ˆì´ìŠ¤ì¼€ì¼ë¡œ ë³€í™˜í•˜ì—¬ ì²˜ë¦¬ ì†ë„ë¥¼ ë†’ì´ê³ , HOGì˜ ì‚¬ëŒ ê²€ì¶œì— ì í•©í•˜ë„ë¡ ë§Œë“­ë‹ˆë‹¤.
human, r = hog.detectMultiScale(gray)
# ì‚¬ëŒì„ ê²€ì¶œí•˜ëŠ” í•¨ìˆ˜ë¡œ, humanì€ ê²€ì¶œëœ ì‚¬ëŒì˜ ìœ„ì¹˜ì™€ í¬ê¸°(ì‚¬ê°í˜• ì¢Œí‘œ) ì •ë³´ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
if (len(human)>0):
    for (x, y, w, h) in human:
        cv2.rectangle(img, (x, y), (x + w, y + h), (255,255,255), 3)
    #  ê²€ì¶œëœ ì˜ì—­ì˜ ì¢Œí‘œì™€ í¬ê¸°ë¥¼ ìˆœíšŒí•˜ë©°, cv2.rectangle í•¨ìˆ˜ë¡œ ì‚¬ê°í˜•ì„ ê·¸ë ¤ ê²€ì¶œëœ ì‚¬ëŒì„ ì‹œê°ì ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤. 255, 255, 255ëŠ” í°ìƒ‰, 3ì€ ì‚¬ê°í˜•ì˜ ë‘ê»˜ì…ë‹ˆë‹¤.

cv2_imshow(img)
cv2.imwrite("temp.jpg",img)
cv2.waitKey(0)
cv2.destroyAllWindows()
```
![alt text](/assets/img_20241102/image-29.png)

### hogParams ê²€ì¶œê¸°ì˜ ë§¤ê°œë³€ìˆ˜

ğŸ”–winStride: (8, 8)

- winStrideëŠ” íƒì§€ ìœˆë„ìš°ê°€ ì´ë™í•˜ëŠ” ë³´í­(stride)ì„ ì§€ì •í•©ë‹ˆë‹¤. (8, 8)ë¡œ ì„¤ì •í•˜ë©´ ê°€ë¡œì™€ ì„¸ë¡œ ë°©í–¥ìœ¼ë¡œ 8í”½ì…€ì”© ì´ë™í•˜ë©° ê²€ì¶œì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
- ë³´í­ì´ ì‘ì„ìˆ˜ë¡ ê²€ì¶œ ì •í™•ë„ê°€ ë†’ì•„ì§€ì§€ë§Œ, ì²˜ë¦¬ ì‹œê°„ì´ ì¦ê°€í•©ë‹ˆë‹¤. ë°˜ëŒ€ë¡œ ë³´í­ì„ í¬ê²Œ ì„¤ì •í•˜ë©´ ê²€ì¶œì´ ë” ë¹ ë¥´ì§€ë§Œ ì‘ì€ ë¬¼ì²´ë¥¼ ë†“ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ”–padding: (32, 32)

- paddingì€ ê° íƒì§€ ìœˆë„ìš° ì£¼ë³€ì— ì¶”ê°€í•˜ëŠ” ì—¬ë°±ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. (32, 32)ë¡œ ì„¤ì •í•˜ë©´ ìœˆë„ìš°ê°€ ì´ë™í•  ë•Œ ì£¼ë³€ì— 32í”½ì…€ì˜ ì—¬ìœ  ê³µê°„ì´ ìƒê¹ë‹ˆë‹¤.
- ê²€ì¶œê¸°ì˜ ì„±ëŠ¥ê³¼ ì •í™•ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ì„œ í•„ìš”í•œ ê²½ìš° paddingì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ë°±ì´ ì¶©ë¶„í• ìˆ˜ë¡ ë°°ê²½ê³¼ì˜ êµ¬ë¶„ì´ ë” ì˜ ì´ë£¨ì–´ì ¸ ì¸ì‹ì´ ì •í™•í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ”–scale: 1.05

- scaleì€ ì´ë¯¸ì§€ í”¼ë¼ë¯¸ë“œë¥¼ ì‚¬ìš©í•  ë•Œ ê° ë‹¨ê³„ì˜ ì¶•ì†Œ ë¹„ìœ¨ì„ ì§€ì •í•©ë‹ˆë‹¤. 1.05ë¡œ ì„¤ì •í•˜ë©´ íƒì§€ ìœˆë„ìš°ì˜ í¬ê¸°ë¥¼ ì•½ 5%ì”© ì¤„ì—¬ê°€ë©° ì‘ì€ ê°ì²´ê¹Œì§€ íƒì§€í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.
- scaleì´ ì‘ì„ìˆ˜ë¡ ë” ë§ì€ ê°ì²´ë¥¼ íƒì§€í•  ìˆ˜ ìˆì§€ë§Œ ì²˜ë¦¬ ì‹œê°„ì´ ì¦ê°€í•˜ë©°, ë„ˆë¬´ í¬ê²Œ ì„¤ì •í•˜ë©´ ì‘ì€ ê°ì²´ë¥¼ ë†“ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ”–hitThreshold: 0

- hitThresholdëŠ” ê²€ì¶œê¸° ì‹ ë¢°ë„ë¥¼ ì„¤ì •í•˜ëŠ” ì„ê³„ê°’ì…ë‹ˆë‹¤. ê°’ì´ ë‚®ì„ìˆ˜ë¡ ë” ë§ì€ ê°ì²´ê°€ íƒì§€ë˜ì§€ë§Œ, ì˜ëª»ëœ ê²€ì¶œ(ì˜¤íƒì§€)ë„ ë§ì•„ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë³´í†µ 0ìœ¼ë¡œ ë‘ì–´ ê²€ì¶œ ê°€ëŠ¥ì„±ì„ ë†’ì´ì§€ë§Œ, ì˜¤íƒì§€ê°€ ë§ì„ ê²½ìš° ê°’ì„ ë†’ì—¬ ì •í™•ë„ë¥¼ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

# 085.ì´ë¯¸ì§€ ì† ì‚¬ëŒ ì–¼êµ´ì„ ê²€ì¶œí•´ ë³´ì

ì „í†µì ìœ¼ë¡œ CascadeClassifierë¥¼ ì´ìš©

```py
import cv2

# ì¤€ë¹„
cascade_file = "/content/drive/MyDrive/á„á…®á„ƒá…¡/á„á…®á„ƒá…¡ 6á„€á…µ/9á„Œá…¡á†¼/haarcascade_frontalface_alt.xml"
# Haar Cascade ë¶„ë¥˜ê¸°ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. ì´ íŒŒì¼ì€ ì‚¬ì „ í•™ìŠµëœ ì–¼êµ´ ê²€ì¶œ ëª¨ë¸ì´ë©°, OpenCVì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ ì–¼êµ´ ì¸ì‹ ëª¨ë¸
cascade = cv2.CascadeClassifier(cascade_file)
# ì–¼êµ´ ê²€ì¶œì„ ìœ„í•œ ë¶„ë¥˜ê¸° ê°ì²´ë¥¼ ìƒì„±

# ê²€ì¶œ
img = cv2.imread("/content/drive/MyDrive/á„á…®á„ƒá…¡/á„á…®á„ƒá…¡ 6á„€á…µ/9á„Œá…¡á†¼/img/img02.jpg")
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
face_list = cascade.detectMultiScale(gray, minSize=(50, 50))
# detectMultiScale í•¨ìˆ˜ë¥¼ í†µí•´ ì–¼êµ´ì„ ê²€ì¶œí•˜ê³ , ê²€ì¶œëœ ì–¼êµ´ì˜ ìœ„ì¹˜ì™€ í¬ê¸°ë¥¼ (x, y, w, h) í˜•íƒœë¡œ ë°˜í™˜
# minSize=(50, 50)ëŠ” ìµœì†Œ ì–¼êµ´ í¬ê¸°ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì¦‰, 50x50 í”½ì…€ ì´ìƒì˜ ì˜ì—­ë§Œì„ ì–¼êµ´ë¡œ ê²€ì¶œ

# ê²€ì¶œí•œ ì–¼êµ´ í‘œì‹œí•˜ê¸°
for (x, y, w, h) in face_list:
    color = (0, 0, 225)
    pen_w = 3
    # pen_w = 3ëŠ” ì‚¬ê°í˜•ì˜ í…Œë‘ë¦¬ ë‘ê»˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    cv2.rectangle(img, (x, y), (x+w, y+h), color, thickness = pen_w)

cv2_imshow(img)
cv2.imwrite("temp.jpg",img)
cv2.waitKey(0)
cv2.destroyAllWindows()
```
![alt text](/assets/img_20241102/image-30.png)

# 086.ì´ë¯¸ì§€ ì† ì‚¬ëŒì˜ ì–¼êµ´ì´ ì–´ëŠ ìª½ì„ ë³´ê³  ìˆëŠ”ì§€ ê²€ì¶œí•´ ë³´ì

dlibì´ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•˜ë©´ ì–¼êµ´ì„ ì–¼êµ´ ëœë“œë§ˆí¬ë¼ê³  ë¶€ë¥´ëŠ” ëˆˆ,ì½”,ì…,ìœ¤ê³½ì˜ 68ê°œ íŠ¹ì§•ì ìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ ìˆìŒ -> ì„¸ì„¸í•œ ì •ë³´ ê²€ì¶œ

```py
import cv2
import dlib
import math

# ì¤€ë¹„ #
predictor = dlib.shape_predictor("/content/drive/MyDrive/á„á…®á„ƒá…¡/á„á…®á„ƒá…¡ 6á„€á…µ/9á„Œá…¡á†¼/shape_predictor_68_face_landmarks.dat")
# predictorëŠ” ì‚¬ì „ í•™ìŠµëœ shape_predictor_68_face_landmarks.dat íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ 68ê°œì˜ ì–¼êµ´ ëœë“œë§ˆí¬ë¥¼ ê²€ì¶œí•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.
detector = dlib.get_frontal_face_detector()
# dlibì˜ ê¸°ë³¸ ì–¼êµ´ ê²€ì¶œê¸°ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤

# ê²€ì¶œ #
img = cv2.imread("/content/drive/MyDrive/á„á…®á„ƒá…¡/á„á…®á„ƒá…¡ 6á„€á…µ/9á„Œá…¡á†¼/img/img02.jpg")
dets = detector(img, 1)
# detectorë¥¼ ì‚¬ìš©í•´ ì–¼êµ´ì„ ê²€ì¶œí•©ë‹ˆë‹¤. detsëŠ” ì–¼êµ´ì˜ ìœ„ì¹˜ë¥¼ í¬í•¨í•œ ì‚¬ê°í˜• ê°ì²´ ë¦¬ìŠ¤íŠ¸

for k, d in enumerate(dets):
    # index(k):0 / d: [(1061, 116) (1216, 270)]
    shape = predictor(img, d)
    # predictorë¥¼ ì‚¬ìš©í•´ ê° ì–¼êµ´ì˜ ëœë“œë§ˆí¬ë¥¼ ê³„ì‚°í•˜ê³ , shape ê°ì²´ì— ì €ì¥í•©ë‹ˆë‹¤.

    # ì–¼êµ´ ì˜ì—­ í‘œì‹œ
    color_f = (0, 0, 225) # ë¹¨
    color_l_out = (255, 0, 0) # íŒŒ
    color_l_in = (0, 255, 0) # ì´ˆ
    line_w = 3
    circle_r = 3
    fontType = cv2.FONT_HERSHEY_SIMPLEX
    fontSize = 1
    # ì–¼êµ´ í…Œë‘ë¦¬ì™€ ëœë“œë§ˆí¬ë¥¼ í‘œì‹œí•  ìƒ‰ìƒê³¼ ì„  ë‘ê»˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    cv2.rectangle(img, (d.left(), d.top()), (d.right(), d.bottom()), color_f, line_w)
    cv2.putText(img, str(k), (d.left(), d.top()), fontType, fontSize, color_f, line_w)
    # ì–¼êµ´ ì˜ì—­ì„ ë¹¨ê°„ìƒ‰ ì‚¬ê°í˜•ìœ¼ë¡œ í‘œì‹œí•˜ê³ , ê° ì–¼êµ´ì— ë²ˆí˜¸ë¥¼ ë¶™ì…ë‹ˆë‹¤.

    # ì¤‘ì‹¬ì„ ê³„ì‚°í•  ì‚¬ê°í˜• ì¤€ë¹„
    num_of_points_out = 17
    num_of_points_in = shape.num_parts - num_of_points_out
    # shape.num_parts í•˜ë©´ ì „ì²´ ëœë“œë§ˆí¬ ìˆ˜
    # num_of_points_outëŠ” ì–¼êµ´ ì™¸ê³½ë¶€ì— í•´ë‹¹í•˜ëŠ” 17ê°œ ëœë“œë§ˆí¬ë¥¼ ì˜ë¯¸í•˜ë©°, ë‚˜ë¨¸ì§€ 51ê°œëŠ” ì–¼êµ´ ë‚´ë¶€ ëœë“œë§ˆí¬ë¡œ ê°„ì£¼
    gx_out = 0
    gy_out = 0
    gx_in = 0
    gy_in = 0
    # gx_out, gy_outëŠ” ì™¸ê³½ë¶€ì˜ ì¤‘ì‹¬ ì¢Œí‘œì´ê³ , gx_in, gy_inì€ ì–¼êµ´ ë‚´ë¶€ì˜ ì¤‘ì‹¬ ì¢Œí‘œ
    for shape_point_count in range(shape.num_parts):
        shape_point = shape.part(shape_point_count)
        #print("ì–¼êµ´ ëœë“œë§ˆí¬No.{} ì¢Œí‘œ ìœ„ì¹˜: ({},{})".format(shape_point_count, shape_point.x, shape_point.y))
        #ì–¼êµ´ ëœë“œë§ˆí¬ë§ˆë‹¤ ê·¸ë¦¬ê¸°
        if shape_point_count<num_of_points_out:
            # ì™¸ê³½
            cv2.circle(img,(shape_point.x, shape_point.y),circle_r,color_l_out, line_w)
            gx_out = gx_out + shape_point.x/num_of_points_out
            gy_out = gy_out + shape_point.y/num_of_points_out
        else:
            # ë‚´ë¶€
            cv2.circle(img,(shape_point.x, shape_point.y),circle_r,color_l_in, line_w)
            gx_in = gx_in + shape_point.x/num_of_points_in
            gy_in = gy_in + shape_point.y/num_of_points_in
        # ëª¨ë“  ëœë“œë§ˆí¬ì— ëŒ€í•´ ë°˜ë³µë¬¸ì„ ëŒë©° ì™¸ê³½ ëœë“œë§ˆí¬ëŠ” íŒŒë€ìƒ‰, ë‚´ë¶€ ëœë“œë§ˆí¬ëŠ” ì´ˆë¡ìƒ‰ìœ¼ë¡œ ì ì„ ê·¸ë¦½ë‹ˆë‹¤.
        # ì™¸ê³½ê³¼ ë‚´ë¶€ ê°ê°ì˜ ì¤‘ì‹¬ì„ êµ¬í•˜ê¸° ìœ„í•´ ê° ëœë“œë§ˆí¬ ì¢Œí‘œì˜ í‰ê· ì„ ê³„ì‚°í•©ë‹ˆë‹¤.

    # ì¤‘ì‹¬ ìœ„ì¹˜ í‘œì‹œ
    cv2.circle(img,(int(gx_out), int(gy_out)),circle_r,(0,0,255), line_w)
    # ì™¸ë¶€-> ë¹¨ê°„ìƒ‰
    cv2.circle(img,(int(gx_in), int(gy_in)),circle_r,(0,0,0), line_w)
    # ë‚´ë¶€ -> ê²€ì •ìƒ‰
    # ì™¸ê³½ê³¼ ë‚´ë¶€ì˜ ì¤‘ì‹¬ì„ ë¹¨ê°„ìƒ‰ê³¼ ê²€ì€ìƒ‰ ì›ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.

    # ì–¼êµ´ ë°©í–¥ ê³„ì‚°
    theta = math.asin(2*(gx_in-gx_out)/(d.right()-d.left()))
    radian = theta*180/math.pi
    print("ì–¼êµ´ ë°©í–¥:{} (ê°ë„:{}ë„)".format(theta,radian))
    # ì–¼êµ´ ë°©í–¥:0.06253283992253719 (ê°ë„:3.582867808528563ë„)
    # asin: ì‚¬ì¸ ê°’ì„ ê°ë„ë¡œ ë³€í™˜
    # ì–¼êµ´ì˜ ë°©í–¥ì„ asinì„ ì‚¬ìš©í•´ ê³„ì‚°í•©ë‹ˆë‹¤. gx_in - gx_outìœ¼ë¡œ ì–¼êµ´ì˜ ê¸°ìš¸ì–´ì§„ ì •ë„ë¥¼ êµ¬í•˜ê³ , ì „ì²´ ì–¼êµ´ ë„ˆë¹„ë¡œ ë‚˜ëˆ„ì–´ ê°ë„ë¥¼ êµ¬í•©ë‹ˆë‹¤. ê°ë„ë¥¼ ë¼ë””ì•ˆê³¼ ë„ ë‹¨ìœ„ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤.
    # d.right() - d.left()ëŠ” ì–¼êµ´ ì „ì²´ì˜ ê°€ë¡œ ê¸¸ì´
    # **2 * (gx_in - gx_out) / (d.right() - d.left())**ëŠ” ì–¼êµ´ì´ ì¢Œìš°ë¡œ ì–¼ë§ˆë‚˜ ê¸°ìš¸ì–´ì¡ŒëŠ”ì§€ë¥¼ 0ê³¼ 1 ì‚¬ì´ì˜ ë¹„ìœ¨ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤. ì´ ê°’ì´ -1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì™¼ìª½ìœ¼ë¡œ, 1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë§ì´ ê¸°ìš¸ì–´ì§„ ê²ƒì…ë‹ˆë‹¤.

    # ì–¼êµ´ ë°©í–¥ í‘œì‹œ
    if radian<0:
        textPrefix = "   left "
    else:
        textPrefix = "   right "
    textShow = textPrefix + str(round(abs(radian),1)) + " deg."
    cv2.putText(img, textShow, (d.left(), d.top()), fontType, fontSize, color_f, line_w)


cv2_imshow(img)
cv2.imwrite("temp.jpg",img)
cv2.waitKey(0)
cv2.destroyAllWindows()
```
![alt text](image.png)
# 087.ê²€ì¶œí•œ ì •ë³´ë¥¼ ì¢…í•©í•´ì„œ íƒ€ì…ë©ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³´ì

- íƒ€ì„ë©ìŠ¤: ì¼ì • ê¸°ê°„ì˜ í”„ë ˆì„ ì¤‘ì—ì„œ 1í”„ë ˆì„ë§Œ êº¼ë‚´ëŠ” "ë¹ ë¥´ê²Œ ì¬ìƒí•˜ê¸°"ì„.

```py
import cv2

print("íƒ€ì„ë©ìŠ¤ ìƒì„± ì‹œì‘")

# ë™ì˜ìƒ ì½ì–´ì˜¤ê¸° #
cap = cv2.VideoCapture("mov/mov01.avi")
width = int(cap.get(cv2.CAP_PROP_FRAME_WIDTH)) #ê°€ë¡œ
height = int(cap.get(cv2.CAP_PROP_FRAME_HEIGHT)) #ì„¸ë¡œ

# hog ì„ ì–¸ #
hog = cv2.HOGDescriptor() 
#  HOG ê¸°ë°˜ì˜ ì‚¬ëŒ ê²€ì¶œê¸°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
hog.setSVMDetector(cv2.HOGDescriptor_getDefaultPeopleDetector())
hogParams = {'winStride': (8, 8), 'padding': (32, 32), 'scale': 1.05, 'hitThreshold':0, 'finalThreshold':5}
# detectMultiScaleì— ì „ë‹¬í•  ë§¤ê°œë³€ìˆ˜ -> ì‚¬ëŒ ê²€ì¶œ ì‹œ ìœˆë„ìš°ì˜ ì´ë™ ë³´í­, íŒ¨ë”©, ìŠ¤ì¼€ì¼ ë“±ì„ ì„¤ì •í•©ë‹ˆë‹¤.
# finalThreshold:  ì—¬ëŸ¬ ë‹¨ê³„ì˜ ê²€ì¶œê¸°ë¥¼ í†µê³¼í•œ í›„ ìµœì¢…ì ìœ¼ë¡œ ê°ì²´ë¡œ ì¸ì‹ë  ë•Œ í•„ìš”í•œ ìµœì†Œ í†µê³¼ ë‹¨ê³„ ìˆ˜ë¥¼ ì„¤ì •í•˜ëŠ” ì„ê³„ê°’

# íƒ€ì„ë©ìŠ¤ ì‘ì„± #
movie_name = "timelapse.avi"
fourcc = cv2.VideoWriter_fourcc('X', 'V', 'I', 'D')
# fourccëŠ” ë¹„ë””ì˜¤ ì½”ë±ì„ ì„¤ì •í•˜ë©°, ì—¬ê¸°ì„œëŠ” 'XVID' ì½”ë±(ìŒì„± ë˜ëŠ” ì˜ìƒì˜ ì‹ í˜¸ë¥¼ ë””ì§€í„¸ ì‹ í˜¸ë¡œ ë³€í™˜í•˜ëŠ” ì½”ë”ì™€ ê·¸ ë°˜ëŒ€ë¡œ ë³€í™˜ì‹œì¼œ ì£¼ëŠ” ë””ì½”ë”ë¥¼ í†µí‹€ì–´ ë¶€ë¥´ëŠ” ìš©ì–´ / ë¹„ë””ì˜¤ ì••ì¶• ë°©ì‹)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
video = cv2.VideoWriter(movie_name,fourcc, 30, (width,height))
# cv2.VideoWriter ê°ì²´ videoëŠ” íƒ€ì„ë©ìŠ¤ ë¹„ë””ì˜¤ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤. FPS(í”„ë ˆì„ ì†ë„ / 1ì´ˆì— í”„ë ˆì„ ëª‡ê°œ?)ëŠ” 30ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.
# ex) (width, height)ì€ widthxheight í•´ìƒë„(Full HD)ë¥¼ ì˜ë¯¸

num = 0
while(cap.isOpened()):
    ret, frame = cap.read()
    if ret:
        if (num%10==0):
            # num % 10 == 0 ì¡°ê±´ì„ ì‚¬ìš©í•´ 10 í”„ë ˆì„ë§ˆë‹¤ í•œ ë²ˆì”© í”„ë ˆì„ì„ ì‚¬ìš©í•´ íƒ€ì„ë©ìŠ¤ íš¨ê³¼ë¥¼ ë§Œë“­ë‹ˆë‹¤.
            gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
            human, r = hog.detectMultiScale(gray, **hogParams)
            # hog.detectMultiScaleì„ ì‚¬ìš©í•´ ì‚¬ëŒì„ ê²€ì¶œí•©ë‹ˆë‹¤. ê²€ì¶œëœ ì‚¬ëŒì´ ìˆë‹¤ë©´, ê° ì‚¬ëŒì„ ì‚¬ê°í˜•ìœ¼ë¡œ í‘œì‹œ
            if (len(human)>0):
                for (x, y, w, h) in human:
                    cv2.rectangle(frame, (x, y), (x + w, y + h), (255,255,255), 3)

            video.write(frame)
            # ì´ í”„ë ˆì„ì€ video.write(frame)ì„ í†µí•´ íƒ€ì„ë©ìŠ¤ ë¹„ë””ì˜¤ì— ì €ì¥
    else:
        break
    num = num + 1
video.release()
cap.release()
# ë¹„ë””ì˜¤ ë‹«ê¸°
cv2.destroyAllWindows()
# OpenCV ì°½ì„ ë‹«ê¸°.
print("íƒ€ì„ë©ìŠ¤ ìƒì„± ì™„ë£Œ")
```
![alt text](/assets/img_20241102/image-31.png)

# 088.ì „ì²´ ëª¨ìŠµì„ ê·¸ë˜í”„ë¡œ ê°€ì‹œí™”í•´ë³´ì

### ì‚¬ëŒ ê²€ì¶œ ê²°ê³¼ë¥¼ ë°ì´í„° í”„ë ˆì„ì— ì €ì¥

```py
import cv2
import pandas as pd

print("ë¶„ì„ ì‹œì‘")
# ë™ì˜ìƒ ì½ì–´ì˜¤ê¸° #
cap = cv2.VideoCapture("mov/mov01.avi")
fps = cap.get(cv2.CAP_PROP_FPS)
# cap.get(cv2.CAP_PROP_FPS)ëŠ” ë¹„ë””ì˜¤ì˜ FPS(ì´ˆë‹¹ í”„ë ˆì„ ìˆ˜)ë¥¼ ê°€ì ¸ì˜´

# hog ì„ ì–¸ #
hog = cv2.HOGDescriptor()
hog.setSVMDetector(cv2.HOGDescriptor_getDefaultPeopleDetector())
hogParams = {'winStride': (8, 8), 'padding': (32, 32), 'scale': 1.05, 'hitThreshold':0, 'finalThreshold':5}

num = 0
# í”„ë ˆì„ ë²ˆí˜¸
list_df = pd.DataFrame( columns=['time','people'] )
while(cap.isOpened()):
    ret, frame = cap.read()
    # retì€ frameì„ ì œëŒ€ë¡œ ì½ì—ˆëŠ”ì§€ ì•ˆì½ì—ˆëŠ”ì§€
    if ret:
        if (num%10==0):
            # íƒ€ì„ë©ìŠ¤
            gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
            human, r = hog.detectMultiScale(gray, **hogParams)
            if (len(human)>0):
                for (x, y, w, h) in human:
                    cv2.rectangle(frame, (x, y), (x + w, y + h), (255,255,255), 3)
            tmp_se = pd.Series( [num/fps,len(human) ], index=list_df.columns )
            list_df = list_df.append( tmp_se, ignore_index=True )       
            if cv2.waitKey(1) & 0xFF == ord('q'):
                break
    else:
        break
    num = num + 1
cap.release()
cv2.destroyAllWindows()
print("ë¶„ì„ ì¢…ë£Œ")
```

### ë°ì´í„° í”„ë ˆì„ ê°€ì‹œí™” ê²°ê³¼

```py
import matplotlib.pyplot as plt
plt.plot(list_df["time"], list_df["people"])
plt.xlabel('time(sec.)')
plt.ylabel('population')
plt.ylim(0,15)
plt.show()
```
![alt text](/assets/img_20241102/image-32.png)

# 089.ê±°ë¦¬ì˜ ë³€í™”ë¥¼ ê·¸ë˜í”„ë¡œ í™•ì¸í•´ ë³´ì

### ì‚¬ëŒ ê²€ì¶œ ê²°ê³¼ë¥¼ ë°ì´í„° í”„ë ˆì„ì— ì €ì¥

```py
import cv2
import pandas as pd

print("ë¶„ì„ ì‹œì‘")
# ë™ì˜ìƒ ì½ì–´ì˜¤ê¸° #
cap = cv2.VideoCapture("mov/mov02.avi")
fps = cap.get(cv2.CAP_PROP_FPS)

# hog ì„ ì–¸ #
hog = cv2.HOGDescriptor()
hog.setSVMDetector(cv2.HOGDescriptor_getDefaultPeopleDetector())
hogParams = {'winStride': (8, 8), 'padding': (32, 32), 'scale': 1.05, 'hitThreshold':0, 'finalThreshold':5}

num = 0
list_df2 = pd.DataFrame( columns=['time','people'] )
while(cap.isOpened()):
    ret, frame = cap.read()
    if ret:
        if (num%10==0):
            gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
            human, r = hog.detectMultiScale(gray, **hogParams)
            if (len(human)>0):
                for (x, y, w, h) in human:
                    cv2.rectangle(frame, (x, y), (x + w, y + h), (255,255,255), 3)
            tmp_se = pd.Series( [num/fps,len(human) ], index=list_df.columns )
            list_df2 = list_df2.append( tmp_se, ignore_index=True )       
            if cv2.waitKey(1) & 0xFF == ord('q'):
                break
    else:
        break
    num = num + 1
cap.release()
cv2.destroyAllWindows()
print("ë¶„ì„ ì¢…ë£Œ")
```

### ë°ì´í„° í”„ë ˆì„ ê°€ì‹œí™” ê²°ê³¼

```py
import matplotlib.pyplot as plt
plt.plot(list_df2["time"], list_df2["people"])
plt.xlabel('time(sec.)')
plt.ylabel('population')
plt.ylim(0,15)
plt.show()
```
![alt text](/assets/img_20241102/image-33.png)

â—HOGë¡œ ë¶„ì„í•œ ë°ì´í„°ëŠ” ë…¸ì´ì¦ˆê°€ ë§ê³  ì˜¤ê²€ì¶œë¡œ ë³€ë™ì´ ë§ì€ ê·¸ë˜í”„ê°€ ë˜ì–´ ê·¸ ì°¨ì´ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ ì–´ë µë‹¤. 

# 090.ì´ë™ í‰ê· ì„ ê³„ì‚°í•´ì„œ ë…¸ì´ì¦ˆë¥¼ ì œê±°í•˜ì

- ë…¸ì´ì¦ˆ: ê³„ì‚°í•´ì•¼ í•  ì‚¬ëŒì„ ê³„ì‚°í•˜ì§€ ì•Šì•„ì„œ ìƒê¸°ëŠ” ì˜¤ì°¨ / ê³„ì‚°í•˜ì§€ ì•Šì•„ë„ ë  ê²ƒì„ ê³„ì‚°í•´ì„œ ìƒê¸°ëŠ” ì˜¤ì°¨ -> í™•ë¥ ì ìœ¼ë¡œ ìƒê¹€<br>
    => ì‹œê°„ì˜ í‰ê· ì„ ê³„ì‚°í•˜ë©´ ì˜¤ì°¨ ì¤„ì¼ ìˆ˜ O

```py
import numpy as np
def moving_average(x, y):
    # ì£¼ì–´ì§„ ë°ì´í„° yì— ëŒ€í•´ ì´ë™ í‰ê· ì„ ê³„ì‚°í•˜ê³ , ê·¸ì— ë§ì¶° x ê°’ì„ ì¬ì¡°ì •í•œ ê²°ê³¼ë¥¼ ë°˜í™˜
    y_conv = np.convolve(y, np.ones(5)/float(5), mode='valid')
    # np.convolveëŠ” ì£¼ì–´ì§„ ë°°ì—´ yì™€ ì¼ì •í•œ ê°’ì„ ê°–ëŠ” í•„í„° np.ones(5) / float(5)ë¥¼ í•©ì„±ê³±(convolution)í•˜ì—¬ ì´ë™ í‰ê·  ê³„ì‚°
    # ì´ í•„í„°ê°€ ì ìš©ë˜ë©´ y ë°°ì—´ì˜ ê° ìš”ì†ŒëŠ” ìì‹ ì„ í¬í•¨í•œ ì´ì›ƒ ë„¤ ê°œì˜ ê°’ê³¼ í‰ê· ì´ ê³„ì‚°ë©ë‹ˆë‹¤. (ì¦‰, ë‹¤ì„¯ ê°œì˜ ê°’ì´ í‰ê· í™”ë¨)
    # mode='valid'ëŠ” ì–‘ ë ë¶€ë¶„ì—ì„œ í•„í„°ê°€ ì™„ì „íˆ ê²¹ì¹˜ëŠ” ê°’ë§Œ ê³„ì‚°í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ê¸¸ì´ê°€ ì›ë˜ yë³´ë‹¤ 4ê°œ ì‘ì€ ê²°ê³¼ë¥¼ ë°˜í™˜
    x_dat = np.linspace(np.min(x), np.max(x), np.size(y_conv))
    return x_dat, y_conv

plt.plot(list_df["time"], list_df["people"], label="raw")
ma_x, ma_y = moving_average(list_df["time"], list_df["people"])
plt.plot(ma_x,ma_y, label="average")
plt.xlabel('time(sec.)')
plt.ylabel('population')
plt.ylim(0,15)
plt.legend()
plt.show()
```
![alt text](/assets/img_20241102/image-34.png)

```py
plt.plot(list_df2["time"], list_df2["people"], label="raw")
ma_x2, ma_y2 = moving_average(list_df2["time"], list_df2["people"])
plt.plot(ma_x2,ma_y2, label="average")
plt.xlabel('time(sec.)')
plt.ylabel('population')
plt.ylim(0,15)
plt.legend()
plt.show()
```
![alt text](/assets/img_20241102/image-35.png)