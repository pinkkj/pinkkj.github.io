---
# Header
title: "3.ê³ ê°ì˜ ì „ì²´ ëª¨ìŠµì„ íŒŒì•…í•˜ëŠ” í…Œí¬ë‹‰ 10"
excerpt: "ê³ ê°ì˜ ì „ì²´ ëª¨ìŠµì„ íŒŒì•…í•˜ëŠ” í…Œí¬ë‹‰ 10"
name: J
writer: J
categories: [ë°ë¹„&ì¶”ì²œì‹œìŠ¤í…œ, íŒŒì´ì¬ ë°ì´í„°ë¶„ì„ ì‹¤ë¬´ í…Œí¬ë‹‰ 100] # [ë©”ì¸ ì¹´í…Œê³ ë¦¬, ì„œë¸Œ ì¹´í…Œê³ ë¦¬]
tags:
  - [Khuda, ML, data]

toc: true
toc_sticky: true

date: 2024-09-21
last_modified_at: 2024-09-21

# --- ì•„ë˜ ë¶€í„° content
---
ğŸ”–ì „ì œ ì¡°ê±´
- ìŠ¤í¬ì¸  ì„¼í„°
  - ì¢…ì¼ íšŒì›: ì–¸ì œë“  ì´ìš© ê°€ëŠ¥
  - ì£¼ê°„ íšŒì›: ë‚®ì—ë§Œ ì´ìš© ê°€ëŠ¥
  - ì•¼ê°„ íšŒì›: ë°¤ì—ë§Œ ì´ìš© ê°€ëŠ¥
- ì •ì±…
  - ì…íšŒë¹„ê°€ ë“¤ì§€ë§Œ, ë¹„ì •ê¸°ì ìœ¼ë¡œ ì…íšŒë¹„ ë°˜ì•¡ í• ì¸ì´ë‚˜ ì…íšŒë¹„ ë¬´ë£Œ í–‰ì‚¬ë¥¼ í•´ì„œ ì‹ ê·œíšŒì›ì„ ëŠ˜ë¦¬ê³  ìˆë‹¤.
  - íƒˆí‡´í•˜ë ¤ë©´ ì›”ë§ê¹Œì§€ ì‹ ì²­í•˜ë©´ ê·¸ ë‹¤ìŒ ë‹¬ ë§ì— íƒˆí‡´ê°€ ëœë‹¤.
- ì·¨ê¸‰í•  ë°ì´í„°

![alt text](/assets/img_20240922/image.png)

# 021.ë°ì´í„°ë¥¼ ì½ì–´ ë“¤ì´ê³  í™•ì¸í•˜ì

â­ ì–´ë–¤ ë°ì´í„°ì—´ì´ ì¡´ì¬í•˜ëŠ”ì§€, ê° ë°ì´í„°ì˜ ê´€ê³„ì„±ê³¼ ê°™ì€ ë°ì´í„°ì˜ í° ë“¤ì„ íŒŒì•…í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

```py
import pandas as pd
uselog = pd.read_csv('use_log.csv')
print(len(uselog))
# 197428
uselog.head()
```
![alt text](/assets/img_20240922/image-1.png)
---

```py
customer = pd.read_csv('customer_master.csv')
print(len(customer))
# 4192
customer.head()
```
![alt text](/assets/img_20240922/image-2.png)

- is_deleted: 2019ë…„ 3ì›” ì‹œì ì— íƒˆí‡´í•œ ìœ ì €ë¥¼ ì‹œìŠ¤í…œì—ì„œ ë¹¨ë¦¬ ì°¾ê¸° ìœ„í•œ ì¹¼ëŸ¼.

---

```py
class_master = pd.read_csv('class_master.csv')
print(len(class_master))
# 3
class_master.head()
```
![alt text](/assets/img_20240922/image-3.png)

---


```py
campaign_master = pd.read_csv('campaign_master.csv')
print(len(campaign_master))
# 3
campaign_master.head()
```
![alt text](/assets/img_20240922/image-4.png)

# 022.ê³ ê° ë°ì´í„°ë¥¼ ê°€ê³µí•˜ì.

â—ê³ ê° ë°ì´í„°(customer)ë¥¼ ê°€ê³µí•œë‹¤.


### ë°ì´í„° ìœ ë‹ˆì–¸

```py
customer_join = pd.merge(customer, class_master, on="class", how="left")
customer_join = pd.merge(customer_join, campaign_master, on="campaign_id", how="left")
customer_join.head()

#í™•ì¸
print(len(customer))
# 4192
print(len(customer_join))
# 4192
```
![alt text](/assets/img_20240922/image-5.png)

### ê²°ì¸¡ì¹˜ í™•ì¸

- ì¡°ì¸ì‹œ ê²°ì¸¡ì¹˜ê°€ ë“¤ì–´ê°€ëŠ” ê²½ìš°
  - ì¡°ì¸ í‚¤x
  - ì¡°ì¸ì´ ì˜ëª»ë  ì‹œ

```py
customer_join.isnull().sum()
# end_date ê²°ì¸¡ì¹˜? -> íƒˆí‡´í•˜ì§€ ì•Šì€ íšŒì›!
```
![alt text](/assets/img_20240922/image-6.png)

# 023.ê³ ê° ë°ì´í„°ë¥¼ ì§‘ê³„í•˜ì

### ê³ ê° ë°ì´í„° ì§‘ê³„

ğŸ”–íšŒì› êµ¬ë¶„

```py
customer_join.groupby("class_name").count()["customer_id"]
```
![alt text](/assets/img_20240922/image-7.png)

ğŸ”–ìº í˜ì¸ êµ¬ë¶„

```py
customer_join.groupby("campaign_name").count()["customer_id"]
```
![alt text](/assets/img_20240922/image-8.png)

ğŸ”–ì„±ë³„

```py
customer_join.groupby("gender").count()["customer_id"]
```
![alt text](/assets/img_20240922/image-9.png)

ğŸ”–íƒˆí‡´?

```py
customer_join.groupby("is_deleted").count()["customer_id"]
```
![alt text](/assets/img_20240922/image-10.png)

ğŸ”–start_dateê°€ 2018.4.1 ~ 2019.3.31 ê¹Œì§€ì¸ ê°€ì… ì¸ì› ì§‘ê³„

```py
customer_join["start_date"] = pd.to_datetime(customer_join["start_date"])
customer_start = customer_join.loc[customer_join["start_date"] > pd.to_datetime("20180401")]
print(len(customer_start))
# 1361
```

# 024.ìµœì‹  ê³ ê° ë°ì´í„°ë¥¼ ì§‘ê³„í•˜ì

ê°€ì¥ ìµœê·¼ ì›”(2019.3)ì˜ ê³ ê° ë°ì´í„°ë¥¼ ì§‘ê³„í•´ì„œ í˜„ì¬ ê³ ê°ì˜ ì „ì²´ ëª¨ìŠµì„ íŒŒì•…í•˜ì.

ğŸ”–ìµœê·¼ ì›”ë¡œ ì¶”ì¶œí•˜ê¸° ìœ„í•´ì„œëŠ”?<br>
1. 2019.3.31ì— íƒˆí‡´í•œ ê³ ê°ê³¼ ì¬ì  ì¤‘ì¸ ê³ ê°ì„ ì¶”ì¶œ
2. is_deleted ì—´ë¡œ ì¶”ì¶œ(â—2019ë…„ 3ì›”ì— íƒˆí‡´í•œ ê³ ê°ì€ ì¹´ìš´íŠ¸ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì£¼ì˜!)

### ìµœê·¼ ì›” ê³ ê° ì§‘ê³„

```py
customer_join["end_date"] = pd.to_datetime(customer_join["end_date"])
customer_newer = customer_join.loc[(customer_join["end_date"] >= pd.to_datetime("20190331")) | (customer_join["end_date"].isna())]
# isna(): isna ì˜ ê²½ìš° ê²°ì¸¡ê°’ì´ë©´ True ë°˜í™˜
print(len(customer_newer))
# 2953
customer_newer["end_date"].unique()
# ['NaT', '2019-03-31 00:00:00']
```

ğŸ”–íšŒì› êµ¬ë¶„

```py
customer_newer.groupby("class_name").count()["customer_id"]
```
![alt text](/assets/img_20240922/image-11.png)

ğŸ”–ìº í˜ì¸ êµ¬ë¶„

```py
customer_newer.groupby("campaign_name").count()["customer_id"]
```
![alt text](/assets/img_20240922/image-12.png)

- ì „ì²´ë¥¼ ì§‘ê³„: ì¼ë°˜ìœ¼ë¡œ ì…íšŒí•œ ìœ ì €ê°€ 72%
- ìµœê·¼ ì›” ì§‘ê³„: ì¼ë°˜ ì…íšŒ ë¹„ìœ¨ì´ 81%<br>
  => **ì…íšŒ ìº í˜ì¸ì€ íšŒì› ë¹„ìœ¨ ë³€í™”ì— ì˜í–¥ì„ ë¯¸ì¹œë‹¤ê³  ì¶”ì¸¡!**

ğŸ”–ì„±ë³„ êµ¬ë¶„

```py
customer_newer.groupby("gender").count()["customer_id"]
```
![alt text](/assets/img_20240922/image-13.png)

# 025.ì´ìš© ì´ë ¥ ë°ì´í„°ë¥¼ ì§‘ê³„í•˜ì

ì´ìš© ì´ë ¥ ë°ì´í„°ëŠ” ê³ ê° ë°ì´í„°ì™€ëŠ” ë‹¬ë¦¬, ì‹œê°„ì ì¸ ìš”ì†Œë¥¼ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì›”/ê³ ê° ì´ìš© íšŸìˆ˜ ì§‘ê³„ ê²°ê³¼

```py
uselog["usedate"] = pd.to_datetime(uselog["usedate"])
uselog["ì—°ì›”"] = uselog["usedate"].dt.strftime("%Y%m")
# ë¬¸ìì—´ë¡œ ë°”ê¾¸ê¸°
uselog_months = uselog.groupby(["ì—°ì›”", "customer_id"],as_index = False).count()
# as_index: ì´ ê·¸ë£¹ì„ ì¸ë±ìŠ¤ë¡œ ì§€ì •í•  ê²ƒì¸ì§€ ì—¬ë¶€
uselog_months.rename(columns={"log_id": "count"}, inplace = True)
del uselog_months["usedate"]
uselog_months.head()
```
![alt text](/assets/img_20240922/image-14.png)

### ê³ ê°ë³„ ì›” ì´ìš© íšŸìˆ˜ ì§‘ê³„ ê²°ê³¼

```py
uselog_customer = uselog_months.groupby("customer_id").agg(["mean", "median", "max", "min"])["count"]
uselog_customer = uselog_customer.reset_index(drop=False)
# groupbyì˜ ì˜í–¥ìœ¼ë¡œ customer_idê°€ indexì— ë“¤ì–´ê°€ ìˆê¸°ì— ì´ê²ƒì„ ì¹¼ëŸ¼ìœ¼ë¡œ ë³€ê²½!
# drop : ì œê±°í•œ ì¸ë±ìŠ¤ë¥¼ ì—´ì— ì¶”ê°€í• ì§€ ì—¬ë¶€
uselog_customer.head()
```
![alt text](/assets/img_20240922/image-15.png)

# 026.ì´ìš© ì´ë ¥ ë°ì´í„°ë¡œë¶€í„° ì •ê¸° ì´ìš© í”Œë˜ê·¸ë¥¼ ì‘ì„±í•˜ì

- ì •ê¸°ì : ë§¤ì£¼ ê°™ì€ ìš”ì¼ì— ì™”ëŠ”ì§€ ì•„ë‹Œì§€ë¡œ íŒë‹¨!<br>
  => ê³ ê°ë§ˆë‹¤ ì›”/ìš”ì¼ë³„ë¡œ ì§‘ê³„í•˜ê³ , ìµœëŒ“ê°’ì´ 4 ì´ìƒì¸ ìš”ì¼ì´ í•˜ë‚˜ë¼ë„ ìˆëŠ” íšŒì›ì€ í”Œë˜ê·¸ë¥¼ 1ë¡œ ì²˜ë¦¬!

### ê³ ê°ë³„ ì›”/ìš”ì¼ ì§‘ê³„ ê²°ê³¼

```py
uselog["weekday"] = uselog["usedate"].dt.weekday
# ìš”ì¼ì„ ìˆ«ìë¡œ ë³€í™˜(0~6ê¹Œì§€ì˜ ìˆ«ìê°€ ê°ê° ì›”ìš”ì¼~ì¼ìš”ì¼ì— í•´ë‹¹)
uselog_weekday = uselog.groupby(["customer_id", "ì—°ì›”", "weekday"], as_index = False).count()[["customer_id", "ì—°ì›”", "weekday", "log_id"]]
uselog_weekday.rename(columns={"log_id":"count"}, inplace=True)
uselog_weekday.head()
```
![alt text](/assets/img_20240922/image-16.png)

### í”Œë˜ê·¸ ì‘ì„±

```py
uselog_weekday = uselog_weekday.groupby("customer_id", as_index = False).max()[["customer_id", "count"]]
uselog_weekday["routine_flg"] = 0
uselog_weekday["routine_flg"] = uselog_weekday["routine_flg"].where(uselog_weekday["count"]<4, 1)
# "count"ê°€ 4ë¯¸ë§Œì¸ ê²½ìš° ê·¸ëŒ€ë¡œ ë‘ê³  4 ì´ìƒì¸ ê²½ìš°ì—ë§Œ 1 ëŒ€ì….
uselog_weekday.head()
```
![alt text](/assets/img_20240922/image-17.png)

# 027.ê³ ê° ë°ì´í„°ì™€ ì´ìš© ì´ë ¥ ë°ì´í„°ë¥¼ ê²°í•©í•˜ì

### ê³ ê° ë°ì´í„°ì™€ ì´ìš©ì´ë ¥ë°ì´í„° ê²°í•©

```py
customer_join = pd.merge(customer_join, uselog_customer, on="customer_id", how="left")
customer_join = pd.merge(customer_join, uselog_weekday[["customer_id", "routine_flg"]], on="customer_id", how="left")
customer_join.head()

customer_join.isnull().sum()
# end_dateì´ì™¸ì—ëŠ” ê²°ì¸¡ì¹˜x
```
![alt text](/assets/img_20240922/image-18.png)

# 028.íšŒì› ê¸°ê°„ì„ ê³„ì‚°í•˜ì

- íšŒì› ê¸°ê°„: end_date - start_date(í•˜ì§€ë§Œ end_dateê°€ ê²°ì¸¡ì¹˜ì¸ ê²½ìš° 20190430ìœ¼ë¡œ ì±„ì›Œì„œ ê³„ì‚°)

### íšŒì› ê¸°ê°„ ê³„ì‚°

```py
from dateutil.relativedelta import relativedelta
# relativedalta: ë‚ ì§œ ë¹„êµ í•¨ìˆ˜
customer_join["calc_date"] = customer_join["end_date"]
customer_join["calc_date"] = customer_join["calc_date"].fillna(pd.to_datetime("20190430"))
customer_join["membership_period"] = 0
for i in range(len(customer_join)):
    delta = relativedelta(customer_join["calc_date"].iloc[i], customer_join["start_date"].iloc[i])
    customer_join["membership_period"].iloc[i] = delta.years*12 + delta.months
customer_join.head()
```
![alt text](/assets/img_20240922/image-19.png)

# â•dateutil ëª¨ë“ˆ

### ë‚ ì§œ ê³„ì‚°: relativedelta

ğŸ”–íŠ¹ì • ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê³¼ê±° ë˜ëŠ” ë¯¸ë˜ ë‚ ì§œ ê³„ì‚°í•˜ê¸°
- relativedelta ê°ì²´ë¥¼ ì´ìš©í•˜ë©´ íŠ¹ì • ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê³¼ê±° ë˜ëŠ” ë¯¸ë˜ ë‚ ì§œë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤.

```py
# í˜„ì¬ ì‹œì ì„ ê¸°ì¤€ìœ¼ë¡œ ê³¼ê±° ë˜ëŠ” ë¯¸ë˜ ì‹œì ì„ ì—°,ì›”,ì¼ ë‹¨ìœ„ë¡œ ê³„ì‚°
from datetime import datetime
from dateutil.relativedelta import relativedelta
 
now = datetime.now().date()
print('í˜„ì¬ ë‚ ì§œ', now)
print('ì‘ë…„', now+relativedelta(years=-1)) 
print('ë‘ë‹¬ì „', now+relativedelta(months=-2)) 
print('3ì¼ í›„', now+relativedelta(days=3)) 
print('1ë…„ 3ë‹¬ í›„', now+relativedelta(years=1, months=3))
```
![alt text](/assets/img_20240922/image-20.png)

ğŸ”–ë‘ ë‚ ì§œì˜ ì°¨ì´ ê³„ì‚°
- relativedeltaì—ì„œ ì²« ë²ˆì§¸, ë‘ ë²ˆì§¸ ì¸ìì— datetime ê°ì²´ë¥¼ ë„£ì–´ì£¼ë©´ ë‘ ë‚ ì§œê°„ ì°¨ì´ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤.

```py
year, month, day = 1981, 1, 1
res = relativedelta(now, datetime(year, month, day)) ## í˜„ì¬ ë‚ ì§œì™€ 1981ë…„ 1ì›” 1ì¼ê³¼ì˜ ë‚ ì§œ ì°¨ì´
print(f'{res.years} years, {res.months} months, {res.days} days')
```
![alt text](/assets/img_20240922/image-21.png)

### íŒŒì‹±

- íŒŒì‹±: ë¬¸ìì—´ë¡œë¶€í„° ë‚ ì§œ íŒ¨í„´ì„ ìë™ìœ¼ë¡œ ì¸ì‹í•˜ì—¬ datetime ê°ì²´ë¡œ ë³€í™˜í•´ ì£¼ëŠ” ê²ƒ.

```py
from dateutil.parser import parse
 
print(parse('20191111231519'), type(parse('20191111231519')))
print(parse('2019-11-11 23:15:19'))
print(parse('2019/11/11'))
```
![alt text](/assets/img_20240922/image-22.png)

### datetime ê°ì²´ ì‹œí€€ìŠ¤ ìƒì„±: rrule

- dateutilì—ì„œ rruleì„ ì´ìš©í•˜ë©´ datetime ê°ì²´ë¥¼ ì›ì†Œë¡œ í•˜ëŠ” ì‹œí€€ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

```py
from dateutil.rrule import rrule, DAILY, MONTHLY, YEARLY
from pprint import pprint
 
## 1987ë…„ 11ì›” 11ì¼ë¶€í„° í•˜ë£¨ ë‹¨ìœ„ë¡œ datetime ê°ì²´ 5ê°œë¥¼ í¬í•¨í•˜ëŠ” ë¦¬ìŠ¤íŠ¸ ìƒì„±
datetime_sequence_day = rrule(DAILY, count=5, dtstart=parse('19871111'))
## 1987ë…„ 11ì›” 11ì¼ë¶€í„° ì›” ë‹¨ìœ„ë¡œ datetime ê°ì²´ 5ê°œë¥¼ í¬í•¨í•˜ëŠ” ë¦¬ìŠ¤íŠ¸ ìƒì„±
datetime_sequence_month = rrule(MONTHLY, count=5, dtstart=parse('19871111'))
## 1987ë…„ 11ì›” 11ì¼ë¶€í„° ì—° ë‹¨ìœ„ë¡œ datetime ê°ì²´ 5ê°œë¥¼ í¬í•¨í•˜ëŠ” ë¦¬ìŠ¤íŠ¸ ìƒì„±
datetime_sequence_year = rrule(YEARLY, count=5, dtstart=parse('19871111'))
pprint('ì¼ ë‹¨ìœ„ ì‹œí€€ìŠ¤')
pprint(list(datetime_sequence_day))
pprint('ì›” ë‹¨ìœ„ ì‹œí€€ìŠ¤')
pprint(list(datetime_sequence_month))
pprint('ì—° ë‹¨ìœ„ ì‹œí€€ìŠ¤')
pprint(list(datetime_sequence_year))
```
![alt text](/assets/img_20240922/image-23.png)


# 029.ê³ ê° í–‰ë™ì˜ ê°ì¢… í†µê³„ëŸ‰ì„ íŒŒì•…í•˜ì

### ê°ì¢… í†µê³„ëŸ‰ ê³„ì‚° ê²°ê³¼

ğŸ”–ë§¤ì›” ì´ìš© íšŸìˆ˜ì˜ mean, median, max, min

```py
customer_join[["mean", "median", "max", "min"]].describe()
```
![alt text](/assets/img_20240922/image-24.png)

ğŸ”–routine_flg

```py
customer_join.groupby("routine_flg").count()["customer_id"]
```
![alt text](/assets/img_20240922/image-25.png)

ğŸ”–íšŒì› ê¸°ê°„ì˜ ë¶„í¬

```py
import matplotlib.pyplot as plt
%matplotlib inline
plt.hist(customer_join["membership_period"])
```
![alt text](/assets/img_20240922/image-26.png)

=> ì§§ì€ ê¸°ê°„ì— ê³ ê°ì´ ë¹ ì ¸ë‚˜ê°€ëŠ” ì—…ê³„ë¼ëŠ” ì˜ë¯¸

# 030.íƒˆí‡´ íšŒì›ê³¼ ì§€ì† íšŒì›ì˜ ì°¨ì´ë¥¼ íŒŒì•…í•˜ì

- íƒˆí‡´ íšŒì›: 1350ëª… / ì§€ì† íšŒì›: 2840ëª…

### í†µê³„ëŸ‰ ì§‘ê³„

ğŸ”–íƒˆí‡´í•œ íšŒì›

```py
customer_end = customer_join.loc[customer_join["is_deleted"]==1]
customer_end.describe()
```
![alt text](/assets/img_20240922/image-27.png)

ğŸ”–ì§€ì† íšŒì›

```py
customer_stay = customer_join.loc[customer_join["is_deleted"] == 0]
customer_stay.describe()

# ì§€ê¸ˆê¹Œì§€ í•œê±° csvë¡œ!
customer_join.to_csv("customer_join.csv", index=False)
```
![alt text](/assets/img_20240922/image-28.png)

ğŸ”– ê²°ë¡ 

- íƒˆí‡´íšŒì›ì˜ ë§¤ì›” ì´ìš© íšŸìˆ˜ì˜ í‰ê· , ì¤‘ì•™, ìµœì†Ÿê°’ì€ ëª¨ë‘ ì§€ì† íšŒì›ë³´ë‹¤ ì‘ë‹¤.
  - í‰ê· ê°’ê³¼ ì¤‘ì•™ê°’ì€ 1.5ë°° ì°¨ì´
  - ë§¤ì›” ìµœëŒ€ ì´ìš© íšŸìˆ˜ì˜ í‰ê· ê°’ì€ íƒˆí‡´ íšŒì›ë„ 6.4
- routine_flgëŠ” ì°¨ì´ê°€ í¬ë‹¤.